<!DOCTYPE html>
<html lang="en" ng-app="app">
<head>
    <meta charset="UTF-8">
    <title>标点后几位</title>
</head>
<body ng-controller="ctrl">
<input type="text" ng-model="myText" name="inputName" decimal-count="3">
<script src="../node_modules/angular/angular.js"></script>
<script>
    angular.module('app', [])
            .controller('ctrl', function ($scope) {
                $scope.myText = '123.454'
            }).directive('decimalCount', function () {
        return {
            require: 'ngModel',
            link: function (scope, element, attrs, ngModel) {
                var count = attrs.decimalCount;
                scope.$watch(attrs.ngModel, function (newVal, oldVal) {
                   // console.log(newVal, oldVal)
                    //console.log(element[0].selectionStart);

                    var startIndex,endIndex;
                    for(var i =0;i<oldVal.length;i++){
                        var flag =   oldVal.charAt(i)==newVal.charAt(i)
                        if(!flag){
                            startIndex = i;
                            break;
                        }
                    }

                    for(var i = oldVal.length-1,z=newVal.length-1;i>=0;i--,z--){
                        var flag = oldVal.charAt(i)==newVal.charAt(z)
                        if(!flag){
                            endIndex=i;
                            break
                        }
                    }

                    var diff = oldVal.substring(startIndex,endIndex+1)
                    console.log(diff)



                    var selectionStart = element[0].selectionStart
                    newVal = newVal+'';
                    var lastStr = '';
                    var lastPoint = newVal.lastIndexOf('.')
                    if (lastPoint > -1) {
                        lastStr = newVal.substring(lastPoint + 1);
                        if (lastStr.length > count) {
                            lastStr = lastStr.substring(0,count);
                        } else {
                            lastStr += '0'.repeat(count - lastStr.length);
                        }
                        newVal = newVal.substring(0, lastPoint)+'.'+lastStr;
                    } else {
                        newVal = newVal + '.'+('0'.repeat(count));
                    }

                    ngModel.$setViewValue(newVal)
                    ngModel.$render();
                    element[0].setSelectionRange(selectionStart, selectionStart)
                })
            }
        };
    });


</script>
</body>
</html>